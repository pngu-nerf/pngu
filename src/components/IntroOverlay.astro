---
/* ScreenOverlay.astro - Precision Silhouette Zoom */
---

<div id="screen-overlay"></div>

<style>
  #screen-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background-color: #000;
    pointer-events: none;
    
    /* THE MASK: Using a gradient layer to "feather" the edges */
    mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    -webkit-mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    
    mask-composite: exclude;
    -webkit-mask-composite: xor;

    /* Start invisible */
    mask-size: 0px auto, 100% 100%;
    -webkit-mask-size: 0px auto, 100% 100%;

    /* FUZZY EDGES: This softens the silhouette pixels */
    filter: blur(8px); 
    
    /* One smooth transition for the initial reveal */
    transition: mask-size 0.8s ease-out, -webkit-mask-size 0.8s ease-out;
  }

  /* STAGE 1: Logo Cutout Appears */
  #screen-overlay.logo-visible {
    mask-size: 180px auto, 100% 100%;
    -webkit-mask-size: 180px auto, 100% 100%;
  }

  /* STAGE 2: One continuous smooth zoom and BG shift */
  #screen-overlay.zoom-active {
    animation: 
      smooth-zoom 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards,
      bg-shift 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes smooth-zoom {
    from {
      -webkit-mask-size: 180px auto, 100% 100%;
      mask-size: 180px auto, 100% 100%;
    }
    to {
      /* Massive expansion to ensure the blurry edges clear the screen */
      -webkit-mask-size: 40000px auto, 100% 100%;
      mask-size: 40000px auto, 100% 100%;
    }
  }

  @keyframes bg-shift {
    from { background-color: #000; }
    to { background-color: rgba(25, 25, 25, 0.7); }
  }

  #screen-overlay.finished {
     display: none;
  }
</style>

<script>
  window.addEventListener('load', () => {
    const overlay = document.getElementById('screen-overlay');
    const banner = document.querySelector('.banner-image');
    if (!overlay) return;

    // CENTER THE ZOOM ON THE BANNER
    if (banner) {
      const rect = banner.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      // Update the mask position to match the banner's center
      overlay.style.maskPosition = `${centerX}px ${centerY}px, center`;
      overlay.style.webkitMaskPosition = `${centerX}px ${centerY}px, center`;
    } else {
      // Fallback to center screen if banner isn't found
      overlay.style.maskPosition = `center, center`;
      overlay.style.webkitMaskPosition = `center, center`;
    }

    // SEQUENCE
    setTimeout(() => {
        overlay.classList.add('logo-visible');
        
        setTimeout(() => {
            overlay.classList.add('zoom-active');
            
            setTimeout(() => {
                overlay.style.opacity = "0";
                overlay.style.transition = "opacity 0.6s ease-out";
                setTimeout(() => {
                    overlay.classList.add('finished');
                }, 600);
            }, 1600);
        }, 800); 
    }, 200); 
  });
</script>
