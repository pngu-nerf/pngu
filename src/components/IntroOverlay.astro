---
/* ScreenOverlay.astro - Banner-Centered Alignment Mode */
---

<div id="screen-overlay"></div>

<svg style="position: absolute; width: 0; height: 0;">
  <filter id="fuzz">
    <feGaussianBlur in="SourceGraphic" stdDeviation="8" />
  </filter>
</svg>

<style>
  #screen-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background-color: #000;
    pointer-events: none;
    
    /* Mask Setup */
    mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    -webkit-mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-composite: exclude;
    -webkit-mask-composite: xor;

    /* Starting Size */
    mask-size: 180px auto, 100% 100%;
    -webkit-mask-size: 180px auto, 100% 100%;

    filter: url(#fuzz);
    
    /* Animation disabled for alignment check */
    animation: none !important;
  }

  /* UNCOMMENT THIS LATER FOR THE LINEAR ZOOM 
  #screen-overlay.zoom-active {
    animation: 
      linear-zoom 1.2s linear forwards,
      bg-fade 1.2s linear forwards;
  }

  @keyframes linear-zoom {
    from { mask-size: 180px auto, 100% 100%; -webkit-mask-size: 180px auto, 100% 100%; }
    to { mask-size: 60000px auto, 100% 100%; -webkit-mask-size: 60000px auto, 100% 100%; }
  }

  @keyframes bg-fade {
    from { background-color: #000; }
    to { background-color: rgba(20, 20, 20, 0.4); }
  }
  */

  #screen-overlay.finished { display: none; }
</style>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const overlay = document.getElementById('screen-overlay');
    const banner = document.querySelector('.banner-image');
    if (!overlay) return;

    // 1. Find Banner Center relative to viewport
    let xPercent = 50;
    let yPercent = 50;

    if (banner) {
      const rect = banner.getBoundingClientRect();
      const centerX = rect.left + (rect.width / 2);
      const centerY = rect.top + (rect.height / 2);
      
      // 2. SVG Offset Logic (Right-shift by 1/3 of the logo width)
      // Since our logo is 180px, 1/3 is 60px.
      const visualX = centerX + 60; 

      // 3. Convert to Screen Percentages
      xPercent = (visualX / window.innerWidth) * 100;
      yPercent = (centerY / window.innerHeight) * 100;
    }

    // Apply the position to the logo layer (layer 0) and the background (layer 1)
    const posString = `${xPercent}% ${yPercent}%, center`;
    overlay.style.maskPosition = posString;
    overlay.style.webkitMaskPosition = posString;

    /* UNCOMMENT THIS TO START THE ZOOM
    requestAnimationFrame(() => {
        overlay.classList.add('zoom-active');
        setTimeout(() => overlay.classList.add('finished'), 1300);
    });
    */
  });
</script>
