---
/* ScreenOverlay.astro - Precision Silhouette Zoom V2 */
---

<div id="screen-overlay"></div>

<svg style="position: absolute; width: 0; height: 0;">
  <filter id="fuzz">
    <feGaussianBlur in="SourceGraphic" stdDeviation="6" />
  </filter>
</svg>

<style>
  #screen-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background-color: #000;
    pointer-events: none;
    
    /* The Mask Setup */
    mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    -webkit-mask-image: url('/brand-assets/PNGU-logo-white.svg'), linear-gradient(#fff, #fff);
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-composite: exclude;
    -webkit-mask-composite: xor;

    /* Start the logo at 0 size */
    mask-size: 0px auto, 100% 100%;
    -webkit-mask-size: 0px auto, 100% 100%;

    /* Apply the SVG Blur to the mask edges */
    filter: url(#fuzz);
    
    /* Smooth transition for Stage 1 only */
    transition: opacity 0.5s ease-out;
  }

  /* STAGE 1: Logo Cutout Appearance */
  #screen-overlay.logo-visible {
    mask-size: 180px auto, 100% 100%;
    -webkit-mask-size: 180px auto, 100% 100%;
  }

  /* STAGE 2: One continuous, accelerating zoom */
  #screen-overlay.zoom-active {
    animation: 
      one-shot-zoom 1.5s cubic-bezier(0.15, 0, 0.85, 1) forwards,
      bg-fade 1.5s ease-in-out forwards;
  }

  @keyframes one-shot-zoom {
    from {
      mask-size: 180px auto, 100% 100%;
      -webkit-mask-size: 180px auto, 100% 100%;
    }
    to {
      /* Massive zoom to clear the screen and stay centered */
      mask-size: 50000px auto, 100% 100%;
      -webkit-mask-size: 50000px auto, 100% 100%;
    }
  }

  @keyframes bg-fade {
    from { background-color: #000; }
    to { background-color: rgba(20, 20, 20, 0.6); }
  }

  #screen-overlay.finished {
     display: none;
  }
</style>

<script>
  window.addEventListener('load', () => {
    const overlay = document.getElementById('screen-overlay');
    const banner = document.querySelector('.banner-image');
    if (!overlay) return;

    // Calculate Banner Center
    let startX = '50%';
    let startY = '50%';

    if (banner) {
      const rect = banner.getBoundingClientRect();
      // We calculate percentages relative to the viewport to keep the mask stable
      startX = `${((rect.left + rect.width / 2) / window.innerWidth) * 100}%`;
      startY = `${((rect.top + rect.height / 2) / window.innerHeight) * 100}%`;
    }

    // Set positions for BOTH mask layers to prevent "corner-drifting"
    // The first coord is the logo, the second is the background (always center)
    const posString = `${startX} ${startY}, center`;
    overlay.style.maskPosition = posString;
    overlay.style.webkitMaskPosition = posString;

    // Trigger the Sequence
    setTimeout(() => {
        overlay.classList.add('logo-visible');
        
        setTimeout(() => {
            overlay.classList.add('zoom-active');
            
            // Cleanup
            setTimeout(() => {
              overlay.classList.add('finished');
            }, 1600);
        }, 900); 
    }, 100); 
  });
</script>
