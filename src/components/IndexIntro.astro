---
/* IndexIntro.astro - Minimalist Black Wipe Reveal */
---

<div id="intro-blackout"></div>
<div id="wipe-layer"></div>

<style is:global>
  /* 1. LOCK VIEWPORT & HIDE CONTENT */
  body.is-intro {
    overflow: hidden !important;
    height: 100vh !important;
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
  }

  body.is-intro main, 
  body.is-intro .index-header,
  body.is-intro .content-box,
  body.is-intro .separator,
  body.is-intro .separator-small {
    visibility: hidden !important;
    opacity: 0 !important;
    transform: translateY(20px);
  }

  /* 2. LAYERS */
  #intro-blackout {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 10000;
  }

  #wipe-layer {
    position: fixed;
    inset: 0;
    height: 400vh; /* Extra tall to prevent 'bar' look */
    z-index: 9999;
    background: linear-gradient(
      to bottom, 
      #000 0%, 
      #000 75%, 
      transparent 100%
    );
    transform: translateY(0); 
    pointer-events: none;
    will-change: transform;
  }

  /* 3. ANIMATION */
  .animate-wipe {
    transition: transform 1.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .reveal-active {
    visibility: visible !important;
    opacity: 1 !important;
    transform: translateY(0) !important;
    transition: 
      opacity 0.8s ease-out, 
      transform 0.8s cubic-bezier(0.23, 1, 0.32, 1) !important;
  }
</style>

<script>
  function runIntro() {
    // Skip if navigating internally
    const internalReferrer = document.referrer && document.referrer.includes(window.location.hostname);
    const blackout = document.getElementById('intro-blackout');
    const wipe = document.getElementById('wipe-layer');

    if (internalReferrer) {
      blackout?.remove();
      wipe?.remove();
      document.body.classList.remove('is-intro');
      return; 
    }

    // Initialize Intro State
    window.scrollTo(0, 0);
    document.body.classList.add('is-intro');

    // Trigger Sequence
    setTimeout(() => {
      // Handover from solid blackout to the wipe layer
      if (blackout) blackout.style.display = 'none';
      
      if (wipe) {
        wipe.classList.add('animate-wipe');
        wipe.style.transform = 'translateY(-100%)';
      }

      // Staggered reveal of the actual page content
      setTimeout(() => {
        document.body.classList.remove('is-intro');
        
        const uiElements = document.querySelectorAll('.index-header, .content-box, .separator, .separator-small');
        uiElements.forEach((el, index) => {
          setTimeout(() => {
            el.classList.add('reveal-active');
          }, index * 120);
        });

        // Final Cleanup
        setTimeout(() => {
          wipe?.remove();
          blackout?.remove();
        }, 1500);
      }, 1200); // Wait for the wipe to clear the middle of the screen
    }, 500); // Initial hold time on pure black
  }

  window.addEventListener('load', runIntro);
</script>
