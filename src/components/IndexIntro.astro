---
/* IndexIntro.astro - Ultra-Tall Feathered Wipe */
---

<div id="intro-blackout"></div>
<div id="wipe-layer"></div>

<style is:global>
  body.is-intro .content-box,
  body.is-intro .separator,
  body.is-intro .index-header {
    opacity: 0;
  }

  /* Banner Proxy */
  #intro-banner-proxy {
    position: fixed;
    z-index: 10000;
    width: 50vw; 
    height: auto;
    pointer-events: none;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.8));
    will-change: transform, width, top, left;
  }

  /* Initial Solid Blackout */
  #intro-blackout {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 9999; /* Highest layer initially */
    transition: opacity 0.6s ease;
  }

  /* THE ULTRA-TALL WIPE */
  #wipe-layer {
    position: fixed;
    left: 0;
    right: 0;
    /* 3x Screen Height to ensure it never looks like a 'bar' */
    height: 300vh; 
    bottom: 0;
    z-index: 9998;
    
    /* Gradient breakdown:
       Top 66% is solid black (keeps the screen covered)
       Bottom 33% is the fade-out (the 'feather')
    */
    background: linear-gradient(
      to bottom, 
      #000 0%, 
      #000 66%, 
      transparent 100%
    );
    
    /* Start completely below the viewport */
    transform: translateY(100%); 
    will-change: transform;
    /* Ensure the wipe doesn't trigger background blurs prematurely */
    pointer-events: none;
  }

  .animate-banner {
    transition: 
      top 1.4s cubic-bezier(0.65, 0, 0.35, 1),
      left 1.4s cubic-bezier(0.65, 0, 0.35, 1),
      width 1.4s cubic-bezier(0.65, 0, 0.35, 1),
      transform 1.4s cubic-bezier(0.65, 0, 0.35, 1);
  }

  .animate-wipe {
    /* Using a very smooth linear-to-ease transition */
    transition: transform 1.6s cubic-bezier(0.2, 0, 0.1, 1);
  }
</style>

<script>
  window.addEventListener('load', () => {
    // Safety check for index page
    if (window.location.pathname !== '/' && window.location.pathname !== '/index.html') return;

    const body = document.body;
    const blackout = document.getElementById('intro-blackout');
    const wipe = document.getElementById('wipe-layer');
    const actualBanner = document.querySelector('.banner-image') as HTMLImageElement;
    
    if (!actualBanner || !blackout || !wipe) return;

    // 1. Lock UI and Create Proxy
    body.classList.add('is-intro');
    const proxy = actualBanner.cloneNode(true) as HTMLImageElement;
    proxy.id = 'intro-banner-proxy';
    body.appendChild(proxy);

    // 2. Begin Sequence
    setTimeout(() => {
      const targetRect = actualBanner.getBoundingClientRect();
      
      // Move Banner to Header position
      proxy.classList.add('animate-banner');
      proxy.style.top = `${targetRect.top + (targetRect.height / 2)}px`;
      proxy.style.left = `${targetRect.left + (targetRect.width / 2)}px`;
      proxy.style.width = `${targetRect.width}px`;

      // 3. Coordinate the Wipe
      setTimeout(() => {
        // Drop the solid blackout so the wipe layer takes over
        blackout.style.opacity = '0';
        
        wipe.classList.add('animate-wipe');
        // Translate the 300vh layer all the way up
        // -100% moves the bottom (the gradient) past the top of the screen
        wipe.style.transform = 'translateY(-100%)';

        // 4. Reveal UI and Cleanup
        setTimeout(() => {
          body.classList.remove('is-intro');
          const uiElements = document.querySelectorAll('.content-box, .separator, .index-header');
          uiElements.forEach(el => (el as HTMLElement).style.opacity = '1');
          
          proxy.remove();
          wipe.remove();
          blackout.remove();
        }, 1600); // Wait for the full wipe duration
      }, 300);
    }, 500);
  });
</script>
