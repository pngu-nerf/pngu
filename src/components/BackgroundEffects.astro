---
// src/components/BackgroundEffects.astro
---
<canvas id="tech-canvas"></canvas>

<style>
    #tech-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
        
        opacity: 0;
        animation: subtleFadeIn 3s ease-in-out 3s forwards;
    }

    @keyframes subtleFadeIn {
        from { opacity: 0; }
        /* 1. BRIGHTER: Increased max opacity from 0.15 to 0.3 */
        to { opacity: 0.3; } 
    }
</style>

<script>
    const canvas = document.getElementById('tech-canvas') as HTMLCanvasElement;
    const ctx = canvas.getContext('2d');

    let width, height;
    let strands = [];

    // Configuration
    const STRAND_COUNT = 15;
    const STRAND_COLOR = '255, 255, 255'; 

    class Strand {
        x: number;
        y: number;
        length: number;
        thickness: number;
        speed: number;
        offset: number;
        amplitude: number;
        frequency: number;

        constructor() {
            this.init();
        }

        init() {
            this.x = Math.random() * width;
            this.y = -Math.random() * height; 
            this.length = height * (0.5 + Math.random() * 0.5); 
            
            // 2. BIGGER: Doubled thickness (was * 2 + 0.5)
            this.thickness = Math.random() * 4 + 1; 

            // 3. SLOWER: Halved vertical speed (was * 0.5 + 0.2)
            this.speed = Math.random() * 0.25 + 0.1; 
            
            this.offset = Math.random() * 100; 
            this.amplitude = Math.random() * 50 + 20; 
            this.frequency = Math.random() * 0.002 + 0.001; 
        }

        update() {
            // Move down
            this.y += this.speed;
            
            // 3. SLOWER: Halved sway speed (was 0.01)
            this.offset += 0.005;

            // Reset if moved past bottom
            if (this.y > height) {
                this.init();
                this.y = -200; 
            }
        }

        draw() {
            if (!ctx) return;
            
            ctx.beginPath();
            
            const grad = ctx.createLinearGradient(this.x, this.y, this.x, this.y + this.length);
            grad.addColorStop(0, `rgba(${STRAND_COLOR}, 0)`);
            // 1. BRIGHTER: Increased alpha to 1.0 (was 0.5)
            grad.addColorStop(0.2, `rgba(${STRAND_COLOR}, 1.0)`); 
            grad.addColorStop(1, `rgba(${STRAND_COLOR}, 0)`);

            ctx.strokeStyle = grad;
            ctx.lineWidth = this.thickness;
            ctx.lineCap = 'round';
            
            let startY = this.y;
            let currentY = startY;
            
            ctx.moveTo(
                this.x + Math.sin(this.offset) * this.amplitude, 
                startY
            );

            for (let i = 0; i <= 20; i++) {
                currentY = startY + (this.length / 20) * i;
                const sway = Math.sin(this.offset + (i * 0.2)) * this.amplitude;
                ctx.lineTo(this.x + sway, currentY);
            }

            // 1. BRIGHTER: Stronger glow (alpha 1.0 instead of 0.5)
            ctx.shadowBlur = 15;
            ctx.shadowColor = "rgba(255, 255, 255, 1.0)";

            ctx.stroke();
            
            ctx.shadowBlur = 0; 
        }
    }

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        
        strands = [];
        for (let i = 0; i < STRAND_COUNT; i++) {
            strands.push(new Strand());
        }
    }

    function animate() {
        if (!ctx) return;
        ctx.clearRect(0, 0, width, height);

        strands.forEach(strand => {
            strand.update();
            strand.draw();
        });

        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize);
    resize();
    animate();
</script>
