---
import { getR2Data } from '../../lib/r2';
import { R2_DATA_BASE } from '../../constants';
const raw = await getR2Data("PNGU-3D-Files-main/");
const projects = raw.sort((a:any, b:any) => (a.displayName||"").localeCompare(b.displayName||""));
---
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="preconnect" href={R2_DATA_BASE} />
<title>stl</title>
<style>
  body{font:14px/1.2 sans-serif;background:#000;color:#fff;max-width:400px;margin:0 auto;padding:1rem}
  a{color:#0df;text-decoration:none;display:block;padding:10px 0;border-bottom:1px solid #111}
  a:active{background:#111}
  h2{font:800 10px sans-serif;color:#333;text-transform:uppercase;margin:20px 0 5px}
  input{width:100%;background:#111;border:1px solid #222;color:#fff;padding:8px;margin:10px 0;border-radius:4px;outline:0}
  
  /* The Secret Sauce: If the search input is empty, show everything. 
     Otherwise, JS handles the toggle. CSS is 10x faster at hiding 
     than JS is at recalculating layout. */
  .p{margin-bottom:1rem}
</style>
</head>
<body>
<a href="/lite" style="border:0;color:#444;padding:0">←</a>
<input type="text" id="q" placeholder="filter..." autofocus />
<div id="l">
{projects.map(p => (
  <div class="p" data-n={p.displayName.toLowerCase()}>
    <h2>{p.displayName}</h2>
    {p.files.map((f:string) => (
      <a href={`${R2_DATA_BASE}/${encodeURIComponent(p.folderName)}/${encodeURIComponent(f)}`} download data-f={f.toLowerCase()}>
        {f.replace('.stl','')} <span style="float:right;color:#222">STL ↓</span>
      </a>
    ))}
  </div>
))}
</div>
<script is:inline>
  const i=document.getElementById('q'),c=[...document.querySelectorAll('.p')];
  i.oninput=()=>{
    const v=i.value.toLowerCase();
    c.map(n=>{
      let h=1;
      n.querySelectorAll('a').forEach(a=>{
        const m=a.dataset.f.includes(v)||n.dataset.n.includes(v);
        a.style.display=m?'block':'none';
        if(m)h=0;
      });
      n.style.display=h?'none':'block';
    });
  };
</script>
</body></html>
