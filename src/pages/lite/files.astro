---
import { getR2Data } from '../../lib/r2';
import { R2_DATA_BASE } from '../../constants';

const raw = await getR2Data("PNGU-3D-Files-main/");
const projects = raw.sort((a:any, b:any) => (a.displayName||"").localeCompare(b.displayName||""));

// Static Alphabetical Grouping
const grouped = projects.reduce((acc: any, p: any) => {
  const char = p.displayName[0].toUpperCase();
  if (!acc[char]) acc[char] = [];
  acc[char].push(p);
  return acc;
}, {});
const letters = Object.keys(grouped).sort();
---
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="preconnect" href={R2_DATA_BASE} />
<title>stl</title>
<style>
  body{font:13px/1.1 sans-serif;background:#333;color:#fff;max-width:400px;margin:0 auto;padding:1rem}
  header{display:flex;justify-content:space-between;margin-bottom:2rem;font-size:11px}
  a{color:#fff;text-decoration:none;display:block;padding:8px 0;border-bottom:1px solid #444}
  a:active{background:#444}
  .h{font:900 20px sans-serif;color:#444;margin:2rem 0 0.5rem}
  h2{font:700 11px sans-serif;color:#aaa;margin:1rem 0 0}
  .meta{color:#555;font-size:10px;margin-top:4rem;text-align:center}
  .back{text-decoration:underline;color:#aaa}
</style>
</head>
<body>
<header>
  <b>PNGU LITE</b>
  <a href="https://pngu.info" class="back">Back to regular site</a>
</header>

<div id="l">
{letters.map(l => (
  <div class="h">{l}</div>
  {grouped[l].map((p:any) => (
    <section>
      <h2>{p.displayName}</h2>
      {p.files.map((f:string) => (
        <a href={`${R2_DATA_BASE}/PNGU-3D-Files-main/${p.folderName}/${f}`} download>
          {f.replace('.stl','')}
        </a>
      ))}
    </section>
  ))}
))}
</div>

<div class="meta">
  <a href="/lite" style="border:0;display:inline">Lite Home</a>
  <p>Â© PNGU</p>
</div>
</body></html>
