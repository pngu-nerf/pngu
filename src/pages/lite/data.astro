---
import { getR2Data } from '../../lib/r2';
import { R2_DATA_BASE } from '../../constants';

// 1. Ensure data is fetched regardless of how the worker routes it
const raw = await getR2Data("PNGU-Blaster-Data-main/") || [];
const projects = raw.sort((a:any, b:any) => (a.displayName||"").localeCompare(b.displayName||""));
const grouped = projects.reduce((acc: any, p: any) => {
  const char = (p.displayName?.[0] || "#").toUpperCase();
  if (!acc[char]) acc[char] = [];
  acc[char].push(p);
  return acc;
}, {});
const letters = Object.keys(grouped).sort();
---
<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:;base64,iVBOR="><link rel="preconnect" href="https://assets.pngu.info"><title>Data | Lite</title><style>body{font:13px sans-serif;background:#333;color:#fff;text-align:center;padding:5vh 1rem}b{display:block;font-size:11px;color:#888;margin-bottom:2rem;text-transform:uppercase}a{color:#fff;text-decoration:none;display:block;padding:12px 0;width:240px;margin:0 auto;border-bottom:1px solid #444}a:active{background:#444}.h{font:900 32px sans-serif;color:#222;margin:2rem 0 0}.reg{display:block;color:#555;font-size:11px;text-decoration:underline;margin-bottom:1rem}.main-site{margin-bottom:3rem}h2{font:700 10px sans-serif;color:#888;margin:1.5rem 0 0;text-transform:uppercase}</style><b>DATA DIRECTORY</b><a href="/" class="reg">Back to home</a><a href="https://pngu.info/data" class="reg main-site">Back to regular site</a>{letters.map(l=>(<><div class="h">{l}</div>{grouped[l].map((p:any)=>(<section><h2>{p.displayName}</h2>{p.files.map((f:string)=>(<a href={`${R2_DATA_BASE}/${encodeURIComponent(p.folderName)}/${encodeURIComponent(f)}`} download={f}>{f}</a>))}</section>))}</>))}
